{% extends "layout.html" %}

{% block content %}
<!-- Enhanced Overview Stats with Animated Icons -->
<div class="stats-container">
    <div class="stat-card" style="border-left: 4px solid var(--accent-primary);">
        <i class="fas fa-database icon" style="animation: pulse 2s infinite;"></i>
        <div class="title">Datasets</div>
        <div class="value">{{ datasets_count }}</div>
        <div class="chart-sparkline">
            <svg width="100%" height="30" viewBox="0 0 100 30">
                <path d="M0,15 L10,18 L20,12 L30,20 L40,15 L50,10 L60,15 L70,5 L80,12 L90,8 L100,15" stroke="var(--accent-primary)" stroke-width="2" fill="none" />
            </svg>
        </div>
    </div>
    
    <div class="stat-card" style="border-left: 4px solid var(--accent-danger);">
        <i class="fas fa-exclamation-triangle icon"></i>
        <div class="title">Anomalies</div>
        <div class="value">{{ anomalies_count }}</div>
        <div class="chart-sparkline">
            <svg width="100%" height="30" viewBox="0 0 100 30">
                <path d="M0,15 L10,25 L20,5 L30,15 L40,10 L50,28 L60,12 L70,18 L80,5 L90,20 L100,15" stroke="var(--accent-danger)" stroke-width="2" fill="none" />
            </svg>
        </div>
    </div>
    
    <div class="stat-card" style="border-left: 4px solid var(--accent-success);">
        <i class="fas fa-lightbulb icon"></i>
        <div class="title">Recommendations</div>
        <div class="value">{{ recommendations_count }}</div>
        <div class="chart-sparkline">
            <svg width="100%" height="30" viewBox="0 0 100 30">
                <path d="M0,25 L20,20 L40,15 L60,10 L80,5 L100,15" stroke="var(--accent-success)" stroke-width="2" fill="none" />
            </svg>
        </div>
    </div>
    
    <div class="stat-card" style="border-left: 4px solid var(--accent-warning);">
        <i class="fas fa-bolt icon"></i>
        <div class="title">Energy Analytics</div>
        <div class="value">Active</div>
        <div class="status-indicator">
            <span class="status-dot" style="background-color: var(--accent-success);"></span>
            <span>System Running</span>
        </div>
    </div>
</div>

<!-- Dashboard Introduction Message -->
<div class="welcome-banner mt-4">
    <div class="card">
        <div class="card-body">
            <h3><i class="fas fa-bolt me-2" style="color: var(--accent-warning);"></i>Welcome to Energy Anomaly Detection</h3>
            <p>Your advanced platform for detecting energy consumption anomalies using machine learning algorithms.</p>
            <p>Navigate using the sidebar to generate data, run anomaly detection, or view recommendations for your energy systems.</p>
        </div>
    </div>
</div>

<!-- Dashboard Content with Enhanced Visualizations -->
<div class="dashboard-grid mt-4">
    <!-- Energy System Visual (Enhanced) -->
    <div class="grid-item grid-item-wide">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3>Energy System Overview</h3>
                <div class="header-actions">
                    <button class="btn btn-sm btn-secondary" onclick="toggleFullScreen(this.parentNode.parentNode.parentNode.parentNode)">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="text-center mb-3">
                    <!-- Energy System SVG Illustration (Enhanced) -->
                    <svg width="100%" height="300" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg">
                        <!-- Smart Grid Background -->
                        <rect x="0" y="0" width="800" height="400" fill="#121212" />
                        <path d="M0,50 L800,50" stroke="#333" stroke-width="1" />
                        <path d="M0,100 L800,100" stroke="#333" stroke-width="1" />
                        <path d="M0,150 L800,150" stroke="#333" stroke-width="1" />
                        <path d="M0,200 L800,200" stroke="#333" stroke-width="1" />
                        <path d="M0,250 L800,250" stroke="#333" stroke-width="1" />
                        <path d="M0,300 L800,300" stroke="#333" stroke-width="1" />
                        <path d="M0,350 L800,350" stroke="#333" stroke-width="1" />
                        
                        <path d="M50,0 L50,400" stroke="#333" stroke-width="1" />
                        <path d="M100,0 L100,400" stroke="#333" stroke-width="1" />
                        <path d="M150,0 L150,400" stroke="#333" stroke-width="1" />
                        <path d="M200,0 L200,400" stroke="#333" stroke-width="1" />
                        <path d="M250,0 L250,400" stroke="#333" stroke-width="1" />
                        <path d="M300,0 L300,400" stroke="#333" stroke-width="1" />
                        <path d="M350,0 L350,400" stroke="#333" stroke-width="1" />
                        <path d="M400,0 L400,400" stroke="#333" stroke-width="1" />
                        <path d="M450,0 L450,400" stroke="#333" stroke-width="1" />
                        <path d="M500,0 L500,400" stroke="#333" stroke-width="1" />
                        <path d="M550,0 L550,400" stroke="#333" stroke-width="1" />
                        <path d="M600,0 L600,400" stroke="#333" stroke-width="1" />
                        <path d="M650,0 L650,400" stroke="#333" stroke-width="1" />
                        <path d="M700,0 L700,400" stroke="#333" stroke-width="1" />
                        <path d="M750,0 L750,400" stroke="#333" stroke-width="1" />
                        
                        <!-- Power Plant -->
                        <g transform="translate(100, 150)">
                            <rect x="0" y="0" width="100" height="100" rx="10" fill="#2d2d2d" stroke="#4da6ff" stroke-width="2" />
                            <rect x="20" y="-30" width="20" height="30" fill="#2d2d2d" />
                            <rect x="60" y="-30" width="20" height="30" fill="#2d2d2d" />
                            <path d="M10,30 L90,30 L90,90 L10,90 Z" fill="#1e1e1e" />
                            <circle cx="50" cy="60" r="20" fill="#4da6ff" opacity="0.7">
                                <animate attributeName="opacity" values="0.7;0.9;0.7" dur="4s" repeatCount="indefinite" />
                            </circle>
                            <text x="50" y="120" text-anchor="middle" fill="white" font-size="14">Power Plant</text>
                        </g>
                        
                        <!-- Transmission Tower -->
                        <g transform="translate(250, 120)">
                            <line x1="25" y1="0" x2="25" y2="150" stroke="#aaa" stroke-width="3" />
                            <line x1="0" y1="30" x2="50" y2="30" stroke="#aaa" stroke-width="3" />
                            <line x1="10" y1="60" x2="40" y2="60" stroke="#aaa" stroke-width="3" />
                            <line x1="15" y1="90" x2="35" y2="90" stroke="#aaa" stroke-width="3" />
                            <path d="M5,30 L25,0 L45,30" stroke="#aaa" stroke-width="2" fill="none" />
                            <text x="25" y="180" text-anchor="middle" fill="white" font-size="14">Transmission</text>
                        </g>
                        
                        <!-- Smart Building -->
                        <g transform="translate(400, 150)">
                            <rect x="0" y="0" width="120" height="100" rx="5" fill="#2d2d2d" stroke="#00cc99" stroke-width="2" />
                            <rect x="15" y="20" width="25" height="25" rx="2" fill="#1e1e1e" />
                            <rect x="50" y="20" width="25" height="25" rx="2" fill="#1e1e1e" />
                            <rect x="85" y="20" width="25" height="25" rx="2" fill="#1e1e1e" />
                            <rect x="15" y="55" width="90" height="35" rx="2" fill="#1e1e1e" />
                            <circle cx="60" cy="70" r="12" fill="#00cc99" opacity="0.7">
                                <animate attributeName="r" values="12;14;12" dur="5s" repeatCount="indefinite" />
                            </circle>
                            <text x="60" y="120" text-anchor="middle" fill="white" font-size="14">Smart Building</text>
                        </g>
                        
                        <!-- Anomaly System -->
                        <g transform="translate(600, 150)">
                            <rect x="0" y="0" width="100" height="100" rx="10" fill="#2d2d2d" stroke="#ff6b6b" stroke-width="2" />
                            <circle cx="50" cy="35" r="20" fill="#ff6b6b" opacity="0.7">
                                <animate attributeName="opacity" values="0.7;0.3;0.7" dur="3s" repeatCount="indefinite" />
                            </circle>
                            <rect x="20" y="65" width="60" height="25" rx="5" fill="#1e1e1e" />
                            <circle cx="30" cy="77.5" r="5" fill="#ff6b6b">
                                <animate attributeName="fill" values="#ff6b6b;#333;#ff6b6b" dur="1.5s" repeatCount="indefinite" />
                            </circle>
                            <circle cx="50" cy="77.5" r="5" fill="#00cc99" />
                            <circle cx="70" cy="77.5" r="5" fill="#4da6ff" />
                            <text x="50" y="120" text-anchor="middle" fill="white" font-size="14">Anomaly Detection</text>
                        </g>
                        
                        <!-- Connection Lines -->
                        <line x1="200" y1="180" x2="250" y2="180" stroke="#4da6ff" stroke-width="3" />
                        <line x1="275" y1="180" x2="400" y2="180" stroke="#4da6ff" stroke-width="3" />
                        <line x1="520" y1="180" x2="600" y2="180" stroke="#4da6ff" stroke-width="3" />
                        
                        <!-- Data Flow Animation -->
                        <circle cx="220" cy="180" r="5" fill="#4da6ff">
                            <animate attributeName="cx" values="200;250" dur="2s" repeatCount="indefinite" />
                        </circle>
                        <circle cx="320" cy="180" r="5" fill="#4da6ff">
                            <animate attributeName="cx" values="275;400" dur="3s" repeatCount="indefinite" />
                        </circle>
                        <circle cx="550" cy="180" r="5" fill="#4da6ff">
                            <animate attributeName="cx" values="520;600" dur="2s" repeatCount="indefinite" />
                        </circle>
                        
                        <!-- Anomaly Pulse -->
                        <circle cx="650" cy="35" r="10" fill="#ff6b6b" opacity="0.5">
                            <animate attributeName="r" values="10;30;10" dur="2s" repeatCount="indefinite" />
                            <animate attributeName="opacity" values="0.5;0;0.5" dur="2s" repeatCount="indefinite" />
                        </circle>
                    </svg>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recent Datasets with Visual Indicators -->
    <div class="grid-item">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3>Recent Datasets</h3>
                <div class="data-count"><span class="badge" style="background-color: var(--accent-primary);">{{ datasets_count }}</span></div>
            </div>
            <div class="card-body p-0">
                {% if recent_datasets %}
                <div class="dataset-list">
                    {% for dataset in recent_datasets %}
                    <div class="dataset-item">
                        <div class="dataset-icon">
                            {% if dataset.is_sample %}
                            <i class="fas fa-flask" style="color: var(--accent-warning);"></i>
                            {% else %}
                            <i class="fas fa-file-alt" style="color: var(--accent-success);"></i>
                            {% endif %}
                        </div>
                        <div class="dataset-info">
                            <div class="dataset-name">{{ dataset.name }}</div>
                            <div class="dataset-meta">
                                <span class="dataset-date">{{ dataset.created_at.strftime('%Y-%m-%d') }}</span>
                                <span class="dataset-type">
                                    {% if dataset.is_sample %}
                                    <span class="status-badge warning">Sample</span>
                                    {% else %}
                                    <span class="status-badge success">Custom</span>
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        <div class="dataset-action">
                            <a href="{{ url_for('view_anomalies') }}" class="btn btn-sm btn-primary">Analyze</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="p-4 text-center empty-state">
                    <i class="fas fa-database fa-3x mb-3" style="color: var(--accent-secondary); opacity: 0.5;"></i>
                    <p>No datasets available. Start by generating sample data or uploading your own.</p>
                    <a href="{{ url_for('generate_data') }}" class="btn btn-primary mt-2">Generate Data</a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Energy Usage Patterns (Sample Visualization) -->
    <div class="grid-item">
        <div class="card h-100">
            <div class="card-header">
                <h3>Energy Consumption Patterns</h3>
            </div>
            <div class="card-body">
                <div id="energy-chart-container" class="chart-placeholder">
                    <canvas id="energyPatternChart" height="250"></canvas>
                    <div class="chart-overlay" id="energy-chart-overlay">
                        <i class="fas fa-chart-line fa-3x"></i>
                        <p>Select a dataset to visualize energy patterns</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Animation for stat cards
        const statCards = document.querySelectorAll('.stat-card');
        statCards.forEach((card, index) => {
            setTimeout(() => {
                card.classList.add('animated');
            }, 100 * index);
        });
        
        // Generate sample energy consumption chart
        const energyChartCtx = document.getElementById('energyPatternChart');
        if (energyChartCtx) {
            // Sample data for demonstration purposes
            const labels = Array.from({length: 24}, (_, i) => `${i}:00`);
            const data = {
                labels: labels,
                datasets: [{
                    label: 'Normal Usage',
                    data: [5, 4, 3, 2, 2, 3, 5, 8, 12, 15, 16, 17, 18, 17, 15, 14, 16, 18, 15, 13, 10, 8, 7, 6],
                    borderColor: '#4da6ff',
                    backgroundColor: 'rgba(77, 166, 255, 0.1)',
                    borderWidth: 2,
                    tension: 0.3,
                    fill: true
                }, {
                    label: 'Anomalies',
                    data: [null, null, null, null, null, null, null, null, null, null, null, null, null, null, 25, null, null, null, null, null, null, null, null, null],
                    borderColor: '#ff6b6b',
                    backgroundColor: 'rgba(255, 107, 107, 0.8)',
                    borderWidth: 0,
                    pointRadius: 6,
                    pointHoverRadius: 8
                }]
            };
            
            // Hide chart overlay since we're showing sample data
            document.getElementById('energy-chart-overlay').style.display = 'none';
            
            // Create chart
            new Chart(energyChartCtx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#ffffff',
                                font: {
                                    family: 'Roboto, sans-serif'
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1e1e1e',
                            titleColor: '#ffffff',
                            bodyColor: '#b3b3b3',
                            borderColor: '#333333',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(51, 51, 51, 0.5)'
                            },
                            ticks: {
                                color: '#b3b3b3'
                            },
                            title: {
                                display: true,
                                text: 'Hour of Day',
                                color: '#ffffff'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(51, 51, 51, 0.5)'
                            },
                            ticks: {
                                color: '#b3b3b3'
                            },
                            title: {
                                display: true,
                                text: 'Energy Consumption (kWh)',
                                color: '#ffffff'
                            }
                        }
                    }
                }
            });
        }
    });
    
    // Toggle fullscreen for visualization cards
    function toggleFullScreen(element) {
        if (!document.fullscreenElement) {
            if (element.requestFullscreen) {
                element.requestFullscreen();
            } else if (element.webkitRequestFullscreen) {
                element.webkitRequestFullscreen();
            } else if (element.msRequestFullscreen) {
                element.msRequestFullscreen();
            }
        } else {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }
    }
</script>
{% endblock %}
